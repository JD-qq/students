<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ - å«ä¾¿ç­¾åŠŸèƒ½</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #6366f1;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --glass: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-attachment: fixed;
            padding: 20px;
        }

        /* ç²’å­èƒŒæ™¯ */
        .particles {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; overflow: hidden; z-index: 0;
        }
        .particle {
            position: absolute; width: 8px; height: 8px;
            background: rgba(255,255,255,0.3); border-radius: 50%;
            animation: floatUp 15s infinite;
        }
        @keyframes floatUp {
            0%, 100% { transform: translateY(100vh); opacity: 0; }
            10%, 90% { opacity: 1; }
            100% { transform: translateY(-100vh); }
        }

        .container { max-width: 1400px; margin: 0 auto; position: relative; z-index: 1; }

        /* å¤´éƒ¨ */
        .header {
            background: var(--glass); backdrop-filter: blur(20px);
            border-radius: 20px; padding: 25px 35px; margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.3);
            display: flex; justify-content: space-between; align-items: center;
            flex-wrap: wrap; gap: 15px;
        }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo-icon { font-size: 40px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
        .logo h1 { color: white; font-size: 24px; }
        .logo p { color: rgba(255,255,255,0.7); font-size: 13px; }

        /* å¯¼èˆªæ ‡ç­¾ */
        .nav-tabs {
            display: flex; gap: 10px;
        }
        .nav-tab {
            padding: 12px 25px; border-radius: 50px; border: 2px solid rgba(255,255,255,0.3);
            background: transparent; color: white; font-weight: 600;
            cursor: pointer; transition: all 0.3s;
        }
        .nav-tab:hover { background: rgba(255,255,255,0.1); }
        .nav-tab.active {
            background: var(--primary); border-color: var(--primary);
            box-shadow: 0 5px 20px rgba(99,102,241,0.4);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            background: var(--glass); backdrop-filter: blur(20px);
            border-radius: 20px; padding: 30px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* å·¥å…·æ  */
        .toolbar {
            display: flex; justify-content: space-between; align-items: center;
            flex-wrap: wrap; gap: 15px; margin-bottom: 25px;
        }
        .search-box {
            position: relative; flex: 1; min-width: 250px; max-width: 400px;
        }
        .search-input {
            width: 100%; padding: 12px 20px 12px 45px;
            border: 2px solid rgba(255,255,255,0.3); border-radius: 50px;
            background: rgba(255,255,255,0.1); color: white; font-size: 15px;
        }
        .search-input::placeholder { color: rgba(255,255,255,0.5); }
        .search-input:focus { outline: none; border-color: white; }
        .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); }

        /* æŒ‰é’® */
        .btn {
            padding: 12px 25px; border: none; border-radius: 50px;
            font-weight: 600; cursor: pointer; transition: all 0.3s;
            display: inline-flex; align-items: center; gap: 8px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .btn-primary { background: linear-gradient(135deg, var(--primary), #818cf8); color: white; }
        .btn-success { background: linear-gradient(135deg, var(--success), #34d399); color: white; }
        .btn-warning { background: linear-gradient(135deg, var(--warning), #fbbf24); color: white; }
        .btn-danger { background: linear-gradient(135deg, var(--danger), #f87171); color: white; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px; margin-bottom: 25px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1); border-radius: 16px; padding: 20px;
            text-align: center; transition: all 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.15); }
        .stat-icon { font-size: 32px; margin-bottom: 10px; }
        .stat-value { font-size: 28px; font-weight: 700; color: white; }
        .stat-label { color: rgba(255,255,255,0.7); font-size: 13px; margin-top: 5px; }

        /* è¡¨æ ¼ */
        .table-container { overflow-x: auto; border-radius: 12px; background: rgba(255,255,255,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { padding: 15px; text-align: left; color: white; font-weight: 600; background: rgba(255,255,255,0.1); }
        td { padding: 15px; color: white; border-bottom: 1px solid rgba(255,255,255,0.1); }
        tbody tr:hover { background: rgba(255,255,255,0.08); }
        .avatar {
            width: 40px; height: 40px; border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #22d3ee);
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 700;
        }
        .gender-tag {
            padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;
        }
        .gender-male { background: #3b82f6; }
        .gender-female { background: #ec4899; }
        .score-badge { padding: 5px 12px; border-radius: 20px; font-weight: 600; font-size: 13px; }
        .score-excellent { background: var(--success); }
        .score-good { background: #3b82f6; }
        .score-average { background: var(--warning); }
        .score-poor { background: var(--danger); }

        /* ==================== ä¾¿ç­¾æ ·å¼ ==================== */
        .notes-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .note-card {
            border-radius: 16px; padding: 20px; min-height: 180px;
            position: relative; transition: all 0.3s; cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .note-card:hover {
            transform: translateY(-5px) rotate(1deg);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }
        .note-card.pinned::before {
            content: 'ğŸ“Œ'; position: absolute; top: -8px; right: 15px; font-size: 24px;
        }

        /* ä¾¿ç­¾é¢œè‰² */
        .note-yellow { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; }
        .note-blue { background: linear-gradient(135deg, #dbeafe, #93c5fd); color: #1e40af; }
        .note-green { background: linear-gradient(135deg, #d1fae5, #6ee7b7); color: #065f46; }
        .note-pink { background: linear-gradient(135deg, #fce7f3, #f9a8d4); color: #9d174d; }
        .note-purple { background: linear-gradient(135deg, #ede9fe, #c4b5fd); color: #5b21b6; }
        .note-red { background: linear-gradient(135deg, #fee2e2, #fca5a5); color: #991b1b; }
        .note-orange { background: linear-gradient(135deg, #ffedd5, #fdba74); color: #9a3412; }

        .note-title {
            font-size: 18px; font-weight: 700; margin-bottom: 12px;
            display: flex; align-items: center; gap: 8px;
        }
        .note-content {
            font-size: 14px; line-height: 1.6; opacity: 0.9;
            white-space: pre-wrap; word-break: break-word;
            max-height: 120px; overflow: hidden;
        }
        .note-footer {
            position: absolute; bottom: 15px; left: 20px; right: 20px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 11px; opacity: 0.6;
        }
        .note-actions {
            display: flex; gap: 8px; opacity: 0; transition: 0.3s;
        }
        .note-card:hover .note-actions { opacity: 1; }
        .note-action-btn {
            width: 28px; height: 28px; border-radius: 50%; border: none;
            background: rgba(0,0,0,0.1); cursor: pointer; font-size: 12px;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .note-action-btn:hover { background: rgba(0,0,0,0.2); transform: scale(1.1); }

        /* æ·»åŠ ä¾¿ç­¾å¡ç‰‡ */
        .add-note-card {
            border: 3px dashed rgba(255,255,255,0.4); border-radius: 16px;
            min-height: 180px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; cursor: pointer;
            transition: all 0.3s; background: rgba(255,255,255,0.05);
        }
        .add-note-card:hover {
            border-color: white; background: rgba(255,255,255,0.1);
            transform: scale(1.02);
        }
        .add-note-icon { font-size: 48px; margin-bottom: 10px; }
        .add-note-text { color: rgba(255,255,255,0.8); font-weight: 600; }

        /* é¢œè‰²é€‰æ‹©å™¨ */
        .color-picker {
            display: flex; gap: 10px; margin: 15px 0;
        }
        .color-option {
            width: 32px; height: 32px; border-radius: 50%; cursor: pointer;
            border: 3px solid transparent; transition: 0.2s;
        }
        .color-option:hover { transform: scale(1.15); }
        .color-option.active { border-color: white; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
        .color-yellow { background: #fde68a; }
        .color-blue { background: #93c5fd; }
        .color-green { background: #6ee7b7; }
        .color-pink { background: #f9a8d4; }
        .color-purple { background: #c4b5fd; }
        .color-red { background: #fca5a5; }
        .color-orange { background: #fdba74; }

        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; padding: 20px;
        }
        .modal {
            background: linear-gradient(135deg, #1e293b, #334155);
            border-radius: 20px; padding: 30px; width: 100%; max-width: 500px;
            max-height: 90vh; overflow-y: auto; color: white;
            box-shadow: 0 25px 60px rgba(0,0,0,0.4);
            animation: modalIn 0.3s ease;
        }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px;
        }
        .modal-title { font-size: 22px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .close-btn {
            width: 36px; height: 36px; border-radius: 50%; border: none;
            background: rgba(255,255,255,0.1); color: white; font-size: 20px;
            cursor: pointer; transition: 0.3s;
        }
        .close-btn:hover { background: var(--danger); transform: rotate(90deg); }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: rgba(255,255,255,0.8); }
        .form-input, .form-textarea, .form-select {
            width: 100%; padding: 12px 16px; border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05);
            color: white; font-size: 15px; transition: 0.3s;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none; border-color: var(--primary);
        }
        .form-textarea { min-height: 150px; resize: vertical; font-family: inherit; }
        .form-select option { background: #1e293b; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-actions { display: flex; gap: 15px; margin-top: 25px; }
        .form-actions .btn { flex: 1; justify-content: center; }

        /* ç©ºçŠ¶æ€ */
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-icon { font-size: 70px; margin-bottom: 15px; }
        .empty-title { color: white; font-size: 22px; margin-bottom: 10px; }
        .empty-desc { color: rgba(255,255,255,0.6); }

        /* åˆ†é¡µ */
        .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 25px; }
        .page-btn {
            width: 38px; height: 38px; border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2); background: transparent;
            color: white; cursor: pointer; transition: 0.3s;
        }
        .page-btn:hover:not(.active):not(:disabled) { background: rgba(255,255,255,0.1); }
        .page-btn.active { background: var(--primary); border-color: var(--primary); }
        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        /* æ¶ˆæ¯æç¤º */
        .toast {
            position: fixed; top: 25px; right: 25px; padding: 16px 25px;
            border-radius: 12px; color: white; font-weight: 600;
            display: flex; align-items: center; gap: 10px; z-index: 3000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.4s ease;
        }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast-success { background: linear-gradient(135deg, var(--success), #34d399); }
        .toast-error { background: linear-gradient(135deg, var(--danger), #f87171); }

        /* ç¡®è®¤å¯¹è¯æ¡† */
        .confirm-dialog { text-align: center; }
        .confirm-icon { font-size: 60px; margin-bottom: 15px; }
        .confirm-title { font-size: 22px; margin-bottom: 10px; }
        .confirm-desc { color: rgba(255,255,255,0.7); margin-bottom: 25px; }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .header { flex-direction: column; text-align: center; }
            .nav-tabs { width: 100%; justify-content: center; }
            .toolbar { flex-direction: column; }
            .search-box { max-width: none; }
            .form-row { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ç²’å­èƒŒæ™¯ -->
        <div class="particles">
            <div v-for="i in 15" :key="i" class="particle"
                 :style="{ left: Math.random()*100+'%', animationDelay: Math.random()*15+'s', animationDuration: (12+Math.random()*8)+'s' }">
            </div>
        </div>

        <!-- æ¶ˆæ¯æç¤º -->
        <div v-if="toast.show" :class="['toast', 'toast-'+toast.type]">
            {{ toast.icon }} {{ toast.msg }}
        </div>

        <div class="container">
            <!-- å¤´éƒ¨ -->
            <header class="header">
                <div class="logo">
                    <span class="logo-icon">ğŸ“</span>
                    <div>
                        <h1>å­¦ç”Ÿç®¡ç†ç³»ç»Ÿ</h1>
                        <p>Student Management System v2.0</p>
                    </div>
                </div>
                <div class="nav-tabs">
                    <button class="nav-tab" :class="{ active: currentTab === 'students' }" @click="currentTab = 'students'">
                        ğŸ‘¥ å­¦ç”Ÿç®¡ç†
                    </button>
                    <button class="nav-tab" :class="{ active: currentTab === 'notes' }" @click="currentTab = 'notes'">
                        ğŸ“ æˆ‘çš„ä¾¿ç­¾
                    </button>
                </div>
            </header>

            <!-- ==================== å­¦ç”Ÿç®¡ç†é¡µé¢ ==================== -->
            <main class="main-content" v-if="currentTab === 'students'">
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¥</div>
                        <div class="stat-value">{{ stats.total }}</div>
                        <div class="stat-label">å­¦ç”Ÿæ€»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘¨â€ğŸ“</div>
                        <div class="stat-value">{{ stats.male }}</div>
                        <div class="stat-label">ç”·ç”Ÿäººæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ‘©â€ğŸ“</div>
                        <div class="stat-value">{{ stats.female }}</div>
                        <div class="stat-label">å¥³ç”Ÿäººæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-value">{{ stats.avgScore }}</div>
                        <div class="stat-label">å¹³å‡åˆ†æ•°</div>
                    </div>
                </div>

                <!-- å·¥å…·æ  -->
                <div class="toolbar">
                    <div class="search-box">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" class="search-input" v-model="studentSearch"
                               placeholder="æœç´¢å­¦ç”Ÿå§“åã€å­¦å·..." @input="currentPage = 1">
                    </div>
                    <button class="btn btn-primary" @click="openStudentModal()">â• æ·»åŠ å­¦ç”Ÿ</button>
                </div>

                <!-- å­¦ç”Ÿè¡¨æ ¼ -->
                <div class="table-container" v-if="filteredStudents.length">
                    <table>
                        <thead>
                            <tr>
                                <th>å¤´åƒ</th>
                                <th>å­¦å·</th>
                                <th>å§“å</th>
                                <th>æ€§åˆ«</th>
                                <th>å¹´é¾„</th>
                                <th>ä¸“ä¸š</th>
                                <th>æˆç»©</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="s in paginatedStudents" :key="s.id">
                                <td><div class="avatar">{{ s.name[0] }}</div></td>
                                <td>{{ s.student_id }}</td>
                                <td><strong>{{ s.name }}</strong></td>
                                <td>
                                    <span :class="['gender-tag', s.gender==='ç”·'?'gender-male':'gender-female']">
                                        {{ s.gender==='ç”·'?'ğŸ‘¨':'ğŸ‘©' }} {{ s.gender }}
                                    </span>
                                </td>
                                <td>{{ s.age }} å²</td>
                                <td>{{ s.major }}</td>
                                <td>
                                    <span :class="['score-badge', getScoreClass(s.score)]">{{ s.score }} åˆ†</span>
                                </td>
                                <td>
                                    <button class="btn btn-warning btn-sm" @click="openStudentModal(s)">âœï¸</button>
                                    <button class="btn btn-danger btn-sm" @click="confirmDeleteStudent(s)">ğŸ—‘ï¸</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="empty-state" v-else>
                    <div class="empty-icon">ğŸ“­</div>
                    <h2 class="empty-title">æš‚æ— å­¦ç”Ÿæ•°æ®</h2>
                    <p class="empty-desc">ç‚¹å‡»"æ·»åŠ å­¦ç”Ÿ"å¼€å§‹å½•å…¥</p>
                </div>

                <!-- åˆ†é¡µ -->
                <div class="pagination" v-if="studentTotalPages > 1">
                    <button class="page-btn" @click="currentPage = 1" :disabled="currentPage === 1">Â«</button>
                    <button class="page-btn" @click="currentPage--" :disabled="currentPage === 1">â€¹</button>
                    <button v-for="p in studentVisiblePages" :key="p" class="page-btn"
                            :class="{ active: p === currentPage }" @click="currentPage = p">{{ p }}</button>
                    <button class="page-btn" @click="currentPage++" :disabled="currentPage === studentTotalPages">â€º</button>
                    <button class="page-btn" @click="currentPage = studentTotalPages" :disabled="currentPage === studentTotalPages">Â»</button>
                </div>
            </main>

            <!-- ==================== ä¾¿ç­¾é¡µé¢ ==================== -->
            <main class="main-content" v-if="currentTab === 'notes'">
                <!-- å·¥å…·æ  -->
                <div class="toolbar">
                    <div class="search-box">
                        <span class="search-icon">ğŸ”</span>
                        <input type="text" class="search-input" v-model="noteSearch"
                               placeholder="æœç´¢ä¾¿ç­¾å†…å®¹...">
                    </div>
                    <div style="color: rgba(255,255,255,0.7);">
                        å…± {{ notes.length }} æ¡ä¾¿ç­¾
                    </div>
                </div>

                <!-- ä¾¿ç­¾ç½‘æ ¼ -->
                <div class="notes-grid">
                    <!-- æ·»åŠ ä¾¿ç­¾å¡ç‰‡ -->
                    <div class="add-note-card" @click="openNoteModal()">
                        <div class="add-note-icon">â•</div>
                        <div class="add-note-text">æ–°å»ºä¾¿ç­¾</div>
                    </div>

                    <!-- ä¾¿ç­¾åˆ—è¡¨ -->
                    <div v-for="note in filteredNotes" :key="note.id"
                         :class="['note-card', 'note-'+note.color, { pinned: note.is_pinned }]"
                         @click="openNoteModal(note)">
                        <div class="note-title">
                            <span>{{ note.is_pinned ? 'ğŸ“Œ' : 'ğŸ“' }}</span>
                            {{ note.title }}
                        </div>
                        <div class="note-content">{{ note.content }}</div>
                        <div class="note-footer">
                            <span>{{ formatDate(note.updated_at) }}</span>
                            <div class="note-actions" @click.stop>
                                <button class="note-action-btn" @click="togglePin(note)" :title="note.is_pinned?'å–æ¶ˆç½®é¡¶':'ç½®é¡¶'">
                                    {{ note.is_pinned ? 'ğŸ“' : 'ğŸ“Œ' }}
                                </button>
                                <button class="note-action-btn" @click="confirmDeleteNote(note)" title="åˆ é™¤">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="empty-state" v-if="filteredNotes.length === 0 && noteSearch">
                    <div class="empty-icon">ğŸ”</div>
                    <h2 class="empty-title">æœªæ‰¾åˆ°åŒ¹é…çš„ä¾¿ç­¾</h2>
                    <p class="empty-desc">è¯•è¯•å…¶ä»–å…³é”®è¯</p>
                </div>
            </main>
        </div>

        <!-- ==================== å­¦ç”Ÿæ¨¡æ€æ¡† ==================== -->
        <div class="modal-overlay" v-if="showStudentModal" @click.self="showStudentModal = false">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">{{ editingStudent ? 'âœï¸ ç¼–è¾‘å­¦ç”Ÿ' : 'â• æ·»åŠ å­¦ç”Ÿ' }}</h2>
                    <button class="close-btn" @click="showStudentModal = false">Ã—</button>
                </div>
                <form @submit.prevent="saveStudent">
                    <div class="form-group">
                        <label class="form-label">å­¦å·</label>
                        <input type="text" class="form-input" v-model="studentForm.student_id" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å§“å</label>
                        <input type="text" class="form-input" v-model="studentForm.name" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">æ€§åˆ«</label>
                            <select class="form-select" v-model="studentForm.gender" required>
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="ç”·">ğŸ‘¨ ç”·</option>
                                <option value="å¥³">ğŸ‘© å¥³</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¹´é¾„</label>
                            <input type="number" class="form-input" v-model.number="studentForm.age" min="16" max="50" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ä¸“ä¸š</label>
                        <select class="form-select" v-model="studentForm.major" required>
                            <option value="">è¯·é€‰æ‹©ä¸“ä¸š</option>
                            <option value="è®¡ç®—æœºç§‘å­¦">ğŸ’» è®¡ç®—æœºç§‘å­¦</option>
                            <option value="è½¯ä»¶å·¥ç¨‹">ğŸ”§ è½¯ä»¶å·¥ç¨‹</option>
                            <option value="äººå·¥æ™ºèƒ½">ğŸ¤– äººå·¥æ™ºèƒ½</option>
                            <option value="æ•°æ®ç§‘å­¦">ğŸ“Š æ•°æ®ç§‘å­¦</option>
                            <option value="ä¿¡æ¯å®‰å…¨">ğŸ”’ ä¿¡æ¯å®‰å…¨</option>
                            <option value="ç‰©è”ç½‘">ğŸŒ ç‰©è”ç½‘</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æˆç»©: {{ studentForm.score }} åˆ†</label>
                        <input type="range" class="form-input" v-model.number="studentForm.score" min="0" max="100">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-danger" @click="showStudentModal = false">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-success">{{ editingStudent ? 'ğŸ’¾ ä¿å­˜' : 'âœ… æ·»åŠ ' }}</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ==================== ä¾¿ç­¾æ¨¡æ€æ¡† ==================== -->
        <div class="modal-overlay" v-if="showNoteModal" @click.self="showNoteModal = false">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">{{ editingNote ? 'âœï¸ ç¼–è¾‘ä¾¿ç­¾' : 'â• æ–°å»ºä¾¿ç­¾' }}</h2>
                    <button class="close-btn" @click="showNoteModal = false">Ã—</button>
                </div>
                <form @submit.prevent="saveNote">
                    <div class="form-group">
                        <label class="form-label">æ ‡é¢˜</label>
                        <input type="text" class="form-input" v-model="noteForm.title" placeholder="ä¾¿ç­¾æ ‡é¢˜" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å†…å®¹</label>
                        <textarea class="form-textarea" v-model="noteForm.content" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„æƒ³æ³•..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">é¢œè‰²</label>
                        <div class="color-picker">
                            <div v-for="c in noteColors" :key="c"
                                 :class="['color-option', 'color-'+c, { active: noteForm.color === c }]"
                                 @click="noteForm.color = c"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" v-model="noteForm.is_pinned" style="width: 18px; height: 18px;">
                            <span class="form-label" style="margin: 0;">ğŸ“Œ ç½®é¡¶æ­¤ä¾¿ç­¾</span>
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-danger" @click="showNoteModal = false">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-success">{{ editingNote ? 'ğŸ’¾ ä¿å­˜' : 'âœ… åˆ›å»º' }}</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ==================== åˆ é™¤ç¡®è®¤æ¡† ==================== -->
        <div class="modal-overlay" v-if="showDeleteConfirm" @click.self="showDeleteConfirm = false">
            <div class="modal">
                <div class="confirm-dialog">
                    <div class="confirm-icon">âš ï¸</div>
                    <h2 class="confirm-title">ç¡®è®¤åˆ é™¤</h2>
                    <p class="confirm-desc">
                        ç¡®å®šè¦åˆ é™¤ <strong style="color: var(--danger);">{{ deleteTarget?.name || deleteTarget?.title }}</strong> å—ï¼Ÿ<br>æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼
                    </p>
                    <div class="form-actions">
                        <button class="btn btn-primary" @click="showDeleteConfirm = false">å–æ¶ˆ</button>
                        <button class="btn btn-danger" @click="executeDelete">ğŸ—‘ï¸ ç¡®è®¤åˆ é™¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        const API = 'https://students-api-y53l.onrender.com/api';

        createApp({
            setup() {
                // ==================== é€šç”¨çŠ¶æ€ ====================
                const currentTab = ref('students');
                const toast = ref({ show: false, msg: '', type: 'success', icon: 'âœ…' });
                const showDeleteConfirm = ref(false);
                const deleteTarget = ref(null);
                const deleteType = ref(''); // 'student' or 'note'

                const showToast = (msg, type = 'success') => {
                    toast.value = { show: true, msg, type, icon: type === 'success' ? 'âœ…' : 'âŒ' };
                    setTimeout(() => toast.value.show = false, 3000);
                };

                // ==================== å­¦ç”Ÿç›¸å…³ ====================
                const students = ref([]);
                const studentSearch = ref('');
                const currentPage = ref(1);
                const pageSize = 8;
                const showStudentModal = ref(false);
                const editingStudent = ref(null);
                const studentForm = ref({ student_id: '', name: '', gender: '', age: 20, major: '', score: 80 });

                const stats = computed(() => {
                    const total = students.value.length;
                    const male = students.value.filter(s => s.gender === 'ç”·').length;
                    const female = students.value.filter(s => s.gender === 'å¥³').length;
                    const avgScore = total ? Math.round(students.value.reduce((sum, s) => sum + s.score, 0) / total) : 0;
                    return { total, male, female, avgScore };
                });

                const filteredStudents = computed(() => {
                    if (!studentSearch.value) return students.value;
                    const q = studentSearch.value.toLowerCase();
                    return students.value.filter(s =>
                        s.name.toLowerCase().includes(q) ||
                        s.student_id.toLowerCase().includes(q) ||
                        s.major.toLowerCase().includes(q)
                    );
                });

                const studentTotalPages = computed(() => Math.ceil(filteredStudents.value.length / pageSize));
                const paginatedStudents = computed(() => {
                    const start = (currentPage.value - 1) * pageSize;
                    return filteredStudents.value.slice(start, start + pageSize);
                });
                const studentVisiblePages = computed(() => {
                    const pages = [];
                    const total = studentTotalPages.value;
                    const curr = currentPage.value;
                    let start = Math.max(1, curr - 2);
                    let end = Math.min(total, start + 4);
                    start = Math.max(1, end - 4);
                    for (let i = start; i <= end; i++) pages.push(i);
                    return pages;
                });

                const getScoreClass = (score) => {
                    if (score >= 90) return 'score-excellent';
                    if (score >= 80) return 'score-good';
                    if (score >= 60) return 'score-average';
                    return 'score-poor';
                };

                const fetchStudents = async () => {
                    try {
                        const res = await axios.get(`${API}/students`);
                        students.value = res.data;
                    } catch (e) {
                        console.log('ä½¿ç”¨æ¨¡æ‹Ÿå­¦ç”Ÿæ•°æ®');
                        students.value = [
                            { id: 1, student_id: '2024001', name: 'å¼ ä¸‰', gender: 'ç”·', age: 20, major: 'è®¡ç®—æœºç§‘å­¦', score: 95 },
                            { id: 2, student_id: '2024002', name: 'æå››', gender: 'å¥³', age: 19, major: 'è½¯ä»¶å·¥ç¨‹', score: 88 },
                        ];
                    }
                };

                const openStudentModal = (student = null) => {
                    editingStudent.value = student;
                    if (student) {
                        studentForm.value = { ...student };
                    } else {
                        studentForm.value = { student_id: '', name: '', gender: '', age: 20, major: '', score: 80 };
                    }
                    showStudentModal.value = true;
                };

                const saveStudent = async () => {
                    try {
                        if (editingStudent.value) {
                            await axios.put(`${API}/students/${editingStudent.value.id}`, studentForm.value);
                            showToast('å­¦ç”Ÿä¿¡æ¯æ›´æ–°æˆåŠŸï¼');
                        } else {
                            await axios.post(`${API}/students`, studentForm.value);
                            showToast('å­¦ç”Ÿæ·»åŠ æˆåŠŸï¼');
                        }
                        fetchStudents();
                        showStudentModal.value = false;
                    } catch (e) {
                        showToast('æ“ä½œå¤±è´¥', 'error');
                    }
                };

                const confirmDeleteStudent = (student) => {
                    deleteTarget.value = student;
                    deleteType.value = 'student';
                    showDeleteConfirm.value = true;
                };

                // ==================== ä¾¿ç­¾ç›¸å…³ ====================
                const notes = ref([]);
                const noteSearch = ref('');
                const showNoteModal = ref(false);
                const editingNote = ref(null);
                const noteColors = ['yellow', 'blue', 'green', 'pink', 'purple', 'red', 'orange'];
                const noteForm = ref({ title: '', content: '', color: 'yellow', is_pinned: false });

                const filteredNotes = computed(() => {
                    if (!noteSearch.value) return notes.value;
                    const q = noteSearch.value.toLowerCase();
                    return notes.value.filter(n =>
                        n.title.toLowerCase().includes(q) ||
                        (n.content && n.content.toLowerCase().includes(q))
                    );
                });

                const formatDate = (dateStr) => {
                    if (!dateStr) return '';
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                };

                const fetchNotes = async () => {
                    try {
                        const res = await axios.get(`${API}/notes`);
                        notes.value = res.data;
                    } catch (e) {
                        console.log('ä½¿ç”¨æ¨¡æ‹Ÿä¾¿ç­¾æ•°æ®');
                        notes.value = [
                            { id: 1, title: 'æ¬¢è¿ä½¿ç”¨ä¾¿ç­¾', content: 'ç‚¹å‡»è¿™é‡Œç¼–è¾‘ä¾¿ç­¾å†…å®¹', color: 'yellow', is_pinned: 1 },
                            { id: 2, title: 'å¾…åŠäº‹é¡¹', content: '1. å®Œæˆä½œä¸š\n2. å¤ä¹ è€ƒè¯•', color: 'blue', is_pinned: 0 },
                        ];
                    }
                };

                const openNoteModal = (note = null) => {
                    editingNote.value = note;
                    if (note) {
                        noteForm.value = {
                            title: note.title,
                            content: note.content || '',
                            color: note.color || 'yellow',
                            is_pinned: !!note.is_pinned
                        };
                    } else {
                        noteForm.value = { title: '', content: '', color: 'yellow', is_pinned: false };
                    }
                    showNoteModal.value = true;
                };

                const saveNote = async () => {
                    try {
                        const data = {
                            ...noteForm.value,
                            is_pinned: noteForm.value.is_pinned ? 1 : 0
                        };
                        if (editingNote.value) {
                            await axios.put(`${API}/notes/${editingNote.value.id}`, data);
                            showToast('ä¾¿ç­¾æ›´æ–°æˆåŠŸï¼');
                        } else {
                            await axios.post(`${API}/notes`, data);
                            showToast('ä¾¿ç­¾åˆ›å»ºæˆåŠŸï¼');
                        }
                        fetchNotes();
                        showNoteModal.value = false;
                    } catch (e) {
                        showToast('æ“ä½œå¤±è´¥', 'error');
                    }
                };

                const togglePin = async (note) => {
                    try {
                        await axios.post(`${API}/notes/${note.id}/toggle-pin`);
                        fetchNotes();
                        showToast(note.is_pinned ? 'å·²å–æ¶ˆç½®é¡¶' : 'å·²ç½®é¡¶');
                    } catch (e) {
                        showToast('æ“ä½œå¤±è´¥', 'error');
                    }
                };

                const confirmDeleteNote = (note) => {
                    deleteTarget.value = note;
                    deleteType.value = 'note';
                    showDeleteConfirm.value = true;
                };

                // ==================== åˆ é™¤æ“ä½œ ====================
                const executeDelete = async () => {
                    try {
                        if (deleteType.value === 'student') {
                            await axios.delete(`${API}/students/${deleteTarget.value.id}`);
                            fetchStudents();
                            showToast('å­¦ç”Ÿåˆ é™¤æˆåŠŸï¼');
                        } else if (deleteType.value === 'note') {
                            await axios.delete(`${API}/notes/${deleteTarget.value.id}`);
                            fetchNotes();
                            showToast('ä¾¿ç­¾åˆ é™¤æˆåŠŸï¼');
                        }
                    } catch (e) {
                        showToast('åˆ é™¤å¤±è´¥', 'error');
                    }
                    showDeleteConfirm.value = false;
                };

                // ==================== åˆå§‹åŒ– ====================
                onMounted(() => {
                    fetchStudents();
                    fetchNotes();
                });

                return {
                    // é€šç”¨
                    currentTab, toast, showDeleteConfirm, deleteTarget, executeDelete,
                    // å­¦ç”Ÿ
                    students, studentSearch, currentPage, filteredStudents, paginatedStudents,
                    studentTotalPages, studentVisiblePages, stats, getScoreClass,
                    showStudentModal, editingStudent, studentForm,
                    openStudentModal, saveStudent, confirmDeleteStudent,
                    // ä¾¿ç­¾
                    notes, noteSearch, filteredNotes, noteColors, formatDate,
                    showNoteModal, editingNote, noteForm,
                    openNoteModal, saveNote, togglePin, confirmDeleteNote
                };
            }
        }).mount('#app');
    </script>
</body>
</html>